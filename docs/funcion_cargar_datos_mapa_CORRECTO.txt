    def cargar_datos_mapa(self):
        # 1. Averiguamos el nombre del archivo JSON (igual que antes)
        nombre_base = os.path.splitext(self.nombre_archivo)[0]
        nombre_json = f"{nombre_base}.json"
        
        # NUEVO! Primero intentar cargar archivo UNIFICADO
        ruta_unificado = os.path.join(DATABASE_PATH, "mapas_unificados", f"{nombre_base}_unificado.json")
        datos = None
        
        if os.path.exists(ruta_unificado):
            try:
                with open(ruta_unificado, 'r', encoding='utf-8') as f:
                    datos = json.load(f)
                print(f"[UNIFICADO] Cargando desde: {ruta_unificado}")
            except Exception as e:
                print(f"[!] Error: {e}. Usando archivos parciales...")
                datos = None
        
        # Si no hay archivo unificado, usar metodo original
        if datos is None:
            # ¡MODIFICADO! ¡Ahora busca el JSON en la sub-carpeta correcta!
            ruta_json = os.path.join(DATABASE_PATH, "mapas", self.categoria, nombre_json)
            
            print(f"Buscando datos del mapa en: {ruta_json}")

            # 2. Abrimos y leemos el archivo JSON (igual que antes)
            try:
                # --- ¡MODIFICADO! Añadimos encoding='utf-8' ---
                with open(ruta_json, 'r', encoding='utf-8') as f:
                    datos = json.load(f)
            except FileNotFoundError:
                # Intentar resolver mediante el índice maps_index.json si existe
                ruta_indice = os.path.join(DATABASE_PATH, 'maps_index.json')
                datos = None
                if os.path.exists(ruta_indice):
                    try:
                        with open(ruta_indice, 'r', encoding='utf-8') as fi:
                            entradas = json.load(fi)
                        for e in entradas:
                            # buscar por id o por nombre base
                            if e.get('id') == nombre_base or os.path.splitext(os.path.basename(e.get('ruta_json','')))[0] == nombre_base:
                                posible = e.get('ruta_json')
                                if posible and os.path.exists(posible):
                                    try:
                                        with open(posible, 'r', encoding='utf-8') as f:
                                            datos = json.load(f)
                                        print(f"Cargado JSON desde índice: {posible}")
                                        break
                                    except Exception:
                                        datos = None
                    except Exception:
                        datos = None

                if datos is None:
                    print(f"¡ADVERTENCIA! No se encontró el archivo de datos: {ruta_json}")
                    print("El mapa se cargará vacío (sin muros, portales, etc.)")
                    return
            except json.JSONDecodeError:
                print(f"¡ERROR! El archivo JSON está mal escrito: {ruta_json}")
                pygame.quit(); sys.exit()
